BEFORE STARTING THIS BEAD:
1. Read GEMINI.md to understand project conventions and workflow
2. Read README.md for system architecture and context
3. Run bd show citations-7rmb to review requirements

---

Context: Before launching embedded checkout to production, there are verification and external coordination tasks.

Pre-Launch Checklist:

1. [OPTIONAL] Email Polar (hello@polar.sh) for Apple Pay/Google Pay
   - NOT required for basic card payments to work
   - Request to add citationformatchecker.com to wallet payments allowlist
   - Can be done after initial launch if desired
   - May take 1-2 business days to process

2. Deploy to staging (AFTER Phase 2 complete)
   - Deploy all component changes to staging environment
   - Verify build succeeds
   - Do NOT delete /success page yet

3. Manual integration test with Polar sandbox + ngrok
   SETUP STEPS:
   a) Get sandbox API keys from Polar dashboard (polar.sh/dashboard)
   b) In backend/.env: POLAR_ACCESS_TOKEN=<sandbox_token>
   c) Start ngrok: ngrok http 5173
   d) In backend/.env: FRONTEND_URL=<ngrok_https_url>
   e) Restart backend: cd backend && flask run
   f) Start frontend: cd frontend/frontend && npm run dev
   
   TEST CARD: 4242 4242 4242 4242, any future date, any CVC
   
   VERIFY:
   - Hit free limit -> upgrade modal appears
   - Click Buy -> embedded iframe opens (NOT redirect!)
   - Complete payment -> iframe closes, success state in modal
   - Credits update immediately
   - Test BOTH modal path and inline pricing path (variants 1.2/2.2)

4. Delete /success page (Phase 3)
   - Only after manual verification passes
   - Deploy cleanup changes

5. Deploy to production
   - Deploy via normal deploy_prod.sh workflow
   - Run E2E tests

6. Monitor checkout_error events for first week
   - Watch dashboard for checkout_error analytics events
   - If error rate > 1%, investigate whether fallback is needed
   - This validates our "no fallback" decision

ROLLBACK PLAN (if issues found):
1. Frontend: Revert checkoutFlow.js to use window.location.href redirect
2. Frontend: Revert component changes (success state removal)
3. Frontend: Restore Success.jsx and route (from git)
4. Backend: Remove embed_origin, restore success_url (backward compatible)
5. Deploy: Deploy both frontend and backend reverts

Time estimate for rollback: ~30 minutes if pre-prepared.
Recommendation: Keep a "rollback" git branch ready with reverted changes.

Dependencies:
- Blocked by: All component updates and test updates complete

Verification:
- Production flow works end-to-end for both modal and inline paths
- Analytics events firing correctly (especially checkout_error)
- No unusual error rates in first 24 hours
